# Apache 反向代理配置
# 适用于 https://p1k3.7x8j0flw.top 服务器

<VirtualHost *:80>
    ServerName p1k3.7x8j0flw.top
    DocumentRoot /path/to/your/website/dist
    
    # 启用必要的模块
    LoadModule proxy_module modules/mod_proxy.so
    LoadModule proxy_http_module modules/mod_proxy_http.so
    LoadModule rewrite_module modules/mod_rewrite.so
    LoadModule headers_module modules/mod_headers.so
    
    # 网站根目录配置
    <Directory "/path/to/your/website/dist">
        AllowOverride All
        Require all granted
        
        # Vue Router 历史模式支持
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>
    
    # API反向代理配置
    <LocationMatch "^/api/(.*)$">
        # 代理到目标API服务器
        ProxyPass https://api.xiaojizy.live/api.php/provide/vod/at/json/$1
        ProxyPassReverse https://api.xiaojizy.live/api.php/provide/vod/at/json/$1
        
        # 设置代理头
        ProxyPreserveHost On
        ProxyAddHeaders On
        
        # 超时设置
        ProxyTimeout 30
        
        # 添加CORS头
        Header always set Access-Control-Allow-Origin "*"
        Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
        
        # 处理OPTIONS预检请求
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L]
    </LocationMatch>
    
    # 静态文件缓存
    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header set Cache-Control "public, immutable"
    </LocationMatch>
    
    # 安全头设置
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # 日志配置
    ErrorLog /var/log/apache2/p1k3.7x8j0flw.top.error.log
    CustomLog /var/log/apache2/p1k3.7x8j0flw.top.access.log combined
</VirtualHost>

# HTTPS配置（如果使用SSL）
<VirtualHost *:443>
    ServerName p1k3.7x8j0flw.top
    DocumentRoot /path/to/your/website/dist
    
    # SSL配置
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key
    
    # 其他配置与HTTP相同...
    # 复制上面的所有配置到这里
</VirtualHost>

# 强制HTTPS重定向（可选）
<VirtualHost *:80>
    ServerName p1k3.7x8j0flw.top
    Redirect permanent / https://p1k3.7x8j0flw.top/
</VirtualHost>
